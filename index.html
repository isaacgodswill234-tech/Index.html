<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ProfitPath Terminal | v7.0 All-in-One</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg: #050505; 
            --accent: #06b6d4; 
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: #fafafa; 
            margin: 0; 
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        input, button, textarea { font-family: inherit; -webkit-tap-highlight-color: transparent; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .animate-in { animation: fadeIn 0.4s cubic-bezier(0.19, 1, 0.22, 1); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: rgba(255,255,255,0.08); 
            border-radius: 10px; 
        }
        
        /* App Specific Styles */
        .glass-panel {
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom": "https://esm.sh/react-dom@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "@google/genai": "https://esm.sh/@google/genai@1.34.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <!-- Application Code -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // --- TELEGRAM API HELPER ---
        const tg = {
            call: async (token, method, body = {}) => {
                try {
                    const resp = await fetch(`https://api.telegram.org/bot${token}/${method}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    return await resp.json();
                } catch (e) {
                    return { ok: false, description: "Network Protocol Error" };
                }
            }
        };

        const App = () => {
            const [tab, setTab] = useState('home');
            const [tgToken, setTgToken] = useState(() => localStorage.getItem('pp_tg_token') || '');
            const [geminiKey, setGeminiKey] = useState(() => localStorage.getItem('pp_gemini_key') || '');
            const [botInfo, setBotInfo] = useState(null);
            const [query, setQuery] = useState('Service arbitrage gaps 2025');
            const [loading, setLoading] = useState(false);
            const [opportunity, setOpportunity] = useState(null);
            const [targets, setTargets] = useState(() => JSON.parse(localStorage.getItem('pp_tg_targets') || '[]'));
            const [logs, setLogs] = useState([]);
            const [isBusy, setIsBusy] = useState(false);
            const [progress, setProgress] = useState(0);
            
            const logEndRef = useRef(null);

            // Nexus States
            const [transmissionMode, setTransmissionMode] = useState(() => localStorage.getItem('pp_tx_mode') || 'direct');
            const [msgContent, setMsgContent] = useState('');
            const [universalLink, setUniversalLink] = useState(() => localStorage.getItem('pp_universal_link') || '');
            const [manualSourceId, setManualSourceId] = useState(() => localStorage.getItem('pp_source_id') || '');
            const [manualId, setManualId] = useState('');

            // Enhanced Universal Parser
            const parsedData = useMemo(() => {
                if (!universalLink.trim()) return { chatId: manualSourceId, msgId: '' };
                try {
                    const cleanLink = universalLink.replace('t.me/c/', 't.me/chat_id_');
                    const url = new URL(cleanLink.startsWith('http') ? cleanLink : `https://${cleanLink}`);
                    const parts = url.pathname.split('/').filter(Boolean);
                    if (parts.length >= 2) {
                        let chatId = parts[0];
                        const msgId = parts[1];
                        if (chatId.startsWith('chat_id_')) {
                            const rawId = chatId.replace('chat_id_', '');
                            chatId = rawId.startsWith('-100') ? rawId : `-100${rawId}`;
                        } else if (!chatId.startsWith('@') && isNaN(Number(chatId))) {
                            chatId = `@${chatId}`;
                        }
                        return { chatId, msgId };
                    }
                } catch (e) {}
                return { chatId: manualSourceId, msgId: universalLink.match(/\d+$/)?.[0] || '' };
            }, [universalLink, manualSourceId]);

            useEffect(() => {
                localStorage.setItem('pp_tg_token', tgToken);
                localStorage.setItem('pp_gemini_key', geminiKey);
                localStorage.setItem('pp_tg_targets', JSON.stringify(targets));
                localStorage.setItem('pp_tx_mode', transmissionMode);
                localStorage.setItem('pp_source_id', manualSourceId);
                localStorage.setItem('pp_universal_link', universalLink);
            }, [tgToken, geminiKey, targets, transmissionMode, manualSourceId, universalLink]);

            useEffect(() => {
                if (tgToken.includes(':')) {
                    tg.call(tgToken, 'getMe').then(r => setBotInfo(r.ok ? r.result : null));
                }
            }, [tgToken]);

            useEffect(() => {
                logEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [logs]);

            const addLog = (target, status, msg) => {
                setLogs(prev => [...prev, { 
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' }), 
                    target, 
                    status, 
                    msg 
                }].slice(-100));
            };

            const deepSync = async () => {
                if (!tgToken) return alert("Bot Token Required.");
                addLog('System', 'info', 'Auto-syncing nodes...');
                const res = await tg.call(tgToken, 'getUpdates', { limit: 100, allowed_updates: ["message", "my_chat_member", "channel_post", "chat_member"] });
                if (res.ok) {
                    const newTargets = [...targets];
                    let foundCount = 0;
                    res.result.forEach((u) => {
                        const chat = u.message?.chat || u.my_chat_member?.chat || u.channel_post?.chat || u.chat_member?.chat;
                        if (chat && !newTargets.some(t => t.id.toString() === chat.id.toString())) {
                            newTargets.push({ id: chat.id.toString(), title: chat.title || chat.username || `Group ${chat.id}`, selected: true, type: chat.type });
                            foundCount++;
                        }
                    });
                    setTargets(newTargets);
                    addLog('Nexus', 'ok', `Nodes synchronized. Added ${foundCount} new.`);
                } else {
                    addLog('Nexus', 'err', "Bot might have Webhook active. Use manual Add.");
                }
            };

            const broadcast = async () => {
                const active = targets.filter(t => t.selected);
                if (!active.length) return alert("Select at least one active target.");
                if (transmissionMode === 'forward' && (!parsedData.chatId || !parsedData.msgId)) {
                    return alert("Mirroring requires a valid post link or ID.");
                }
                setIsBusy(true);
                setProgress(0);
                addLog('Sequence', 'info', `Starting transmission to ${active.length} nodes...`);
                let i = 0;
                for (const t of active) {
                    let r;
                    if (transmissionMode === 'direct') {
                        r = await tg.call(tgToken, 'sendMessage', { chat_id: t.id, text: msgContent, parse_mode: 'HTML' });
                    } else {
                        r = await tg.call(tgToken, 'forwardMessage', { chat_id: t.id, from_chat_id: parsedData.chatId, message_id: parseInt(parsedData.msgId) });
                    }
                    const targetName = t.title.substring(0, 15);
                    if (r.ok) addLog(targetName, 'ok', "Data Pushed");
                    else addLog(targetName, 'err', r.description);
                    i++;
                    setProgress(Math.round((i / active.length) * 100));
                    await new Promise(res => setTimeout(res, 2500)); 
                }
                setIsBusy(false);
                setProgress(0);
                addLog('Sequence', 'info', "Mission Complete.");
            };

            const analyzeNiche = async () => {
                setLoading(true);
                try {
                    const key = geminiKey || process.env.API_KEY;
                    const ai = new GoogleGenAI({ apiKey: key });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-pro-preview',
                        contents: `persona: Truthful Venture Analyst. niche: ${query}. Goal: identify a high-margin service arbitrage. Return JSON with keys: title, truthScore (0-100), theGrind (the hard parts), blueprint, actionSteps (array), competitionLevel.`,
                        config: { tools: [{ googleSearch: {} }], responseMimeType: 'application/json' }
                    });
                    setOpportunity(JSON.parse(response.text));
                } catch (e) {
                    alert("Analysis Failed. Check API Key and Network.");
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex flex-col max-w-lg mx-auto bg-[#050505] text-[#fafafa] font-sans selection:bg-cyan-500 selection:text-black">
                    {isBusy && (
                        <div className="fixed top-0 left-0 right-0 h-1 bg-white/5 z-[100]">
                            <div className="h-full bg-cyan-500 transition-all duration-500 shadow-[0_0_10px_cyan]" style={{ width: `${progress}%` }} />
                        </div>
                    )}

                    <header className="p-8 pt-14 pb-4">
                        <div className="flex items-center justify-between">
                            <div className="group">
                                <h1 className="text-3xl font-black tracking-tighter text-white group-hover:text-cyan-400 transition-colors">ProfitPath</h1>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className="text-[9px] font-black uppercase tracking-[0.4em] text-cyan-500/60">Final Standalone v7.0</span>
                                    {isBusy && <div className="w-1 h-1 bg-cyan-500 rounded-full animate-ping"></div>}
                                </div>
                            </div>
                            <div className="text-right">
                                <div className={`px-4 py-1.5 rounded-2xl text-[10px] font-black uppercase border transition-all ${botInfo ? 'bg-cyan-500/10 border-cyan-500/20 text-cyan-400' : 'bg-red-500/10 border-red-500/20 text-red-500'}`}>
                                    {botInfo ? `@${botInfo.username}` : 'Offline'}
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 px-6 pb-28 overflow-y-auto space-y-6 custom-scrollbar">
                        {tab === 'home' && (
                            <div className="space-y-6 animate-in">
                                <div className="relative">
                                    <input 
                                        value={query} onChange={e => setQuery(e.target.value)}
                                        placeholder="Market niche..." 
                                        className="w-full bg-[#111] border border-white/5 rounded-[32px] py-5 px-8 text-sm font-semibold focus:border-cyan-500/50 outline-none transition-all shadow-2xl" 
                                    />
                                    <button 
                                        onClick={analyzeNiche} 
                                        disabled={loading}
                                        className="absolute right-3 top-3 bottom-3 bg-cyan-500 rounded-[24px] px-6 text-black font-black uppercase text-[10px] active:scale-95 transition-all shadow-lg"
                                    >
                                        {loading ? 'Thinking' : 'Analyze'}
                                    </button>
                                </div>

                                {opportunity && (
                                    <div className="bg-[#111] rounded-[40px] p-8 border border-white/5 space-y-8 shadow-2xl">
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-2xl font-black text-white leading-tight tracking-tight pr-4">{opportunity.title}</h3>
                                            <div className="text-right">
                                                <div className="text-3xl font-black text-cyan-400 tracking-tighter leading-none">{opportunity.truthScore}%</div>
                                                <p className="text-[8px] text-gray-500 font-black uppercase mt-1">Viability</p>
                                            </div>
                                        </div>
                                        <div className="p-6 bg-red-500/5 rounded-3xl border border-red-500/10 relative overflow-hidden">
                                            <h4 className="text-[9px] font-black text-red-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                                                <span className="w-1.5 h-1.5 bg-red-500 rounded-full"></span>
                                                The Grind
                                            </h4>
                                            <p className="text-xs text-red-100/60 leading-relaxed font-medium italic">"{opportunity.theGrind}"</p>
                                        </div>
                                        <div className="space-y-4">
                                            <h4 className="text-[9px] font-black text-gray-500 uppercase tracking-widest px-2">Operational Logic</h4>
                                            <div className="space-y-3">
                                                {opportunity.actionSteps?.map((s, i) => (
                                                    <div key={i} className="flex gap-5 items-start">
                                                        <span className="w-7 h-7 flex-shrink-0 flex items-center justify-center bg-white/5 border border-white/5 text-cyan-400 rounded-full text-[10px] font-black">{i+1}</span>
                                                        <p className="text-xs text-gray-300 font-medium leading-relaxed pt-1.5">{s}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
      </div>
                                  )}
                            </div>
                        )}

                        {tab === 'nexus' && (
                            <div className="space-y-6 animate-in">
                                <div className="bg-[#111] p-1.5 rounded-[32px] flex border border-white/5 shadow-2xl">
                                    <button onClick={() => setTransmissionMode('direct')} className={`flex-1 py-3.5 rounded-[24px] text-[10px] font-black uppercase tracking-widest transition-all ${transmissionMode === 'direct' ? 'bg-cyan-500 text-black shadow-lg shadow-cyan-500/20' : 'text-gray-500 hover:text-gray-300'}`}>Direct Payload</button>
                                    <button onClick={() => setTransmissionMode('forward')} className={`flex-1 py-3.5 rounded-[24px] text-[10px] font-black uppercase tracking-widest transition-all ${transmissionMode === 'forward' ? 'bg-cyan-500 text-black shadow-lg shadow-cyan-500/20' : 'text-gray-500 hover:text-gray-300'}`}>Channel Mirror</button>
                                </div>

                                <div className="bg-[#111] rounded-[40px] p-6 border border-white/5 space-y-4 shadow-2xl">
                                    <div className="flex items-center justify-between px-3">
                                        <h4 className="text-[9px] font-black text-gray-600 uppercase tracking-widest">Target Nodes ({targets.length})</h4>
                                        <button onClick={deepSync} className="text-[9px] font-black text-cyan-400 uppercase tracking-widest hover:text-cyan-300">Refresh All</button>
                                    </div>
                                    <div className="flex gap-2">
                                        <input value={manualId} onChange={e => setManualId(e.target.value)} placeholder="ID: -100123456..." className="flex-1 bg-black/40 border border-white/5 p-4 rounded-2xl text-xs font-mono outline-none focus:border-cyan-500/50" />
                                        <button onClick={async () => {
                                            if (!manualId.trim()) return;
                                            const res = await tg.call(tgToken, 'getChat', { chat_id: manualId });
                                            if (res.ok) {
                                                setTargets(prev => [{ id: manualId, title: res.result.title || res.result.username || manualId, selected: true, type: res.result.type }, ...prev]);
                                                setManualId('');
                                            } else alert("Bot must be in the chat first!");
                                        }} className="bg-white/5 px-6 rounded-2xl text-[9px] font-black uppercase border border-white/10 active:bg-white/10">Add</button>
                                    </div>
                                    <div className="max-h-56 overflow-y-auto space-y-2 pr-1 custom-scrollbar">
                                        {targets.map(t => (
                                            <div key={t.id} onClick={() => setTargets(prev => prev.map(x => x.id === t.id ? {...x, selected: !x.selected} : x))} className={`p-4 rounded-2xl border transition-all flex items-center justify-between cursor-pointer ${t.selected ? 'border-cyan-500/40 bg-cyan-500/5 text-cyan-400' : 'border-white/5 bg-white/[0.02] text-gray-700 opacity-60'}`}>
                                                <div className="truncate w-40">
                                                    <p className="text-xs font-bold truncate">{t.title}</p>
                                                    <p className="text-[8px] font-black uppercase opacity-50 tracking-widest">{t.type} // {t.id}</p>
                                                </div>
                                                <div className={`w-4 h-4 rounded-full border-2 transition-all ${t.selected ? 'bg-cyan-500 border-cyan-500 shadow-[0_0_12px_rgba(6,182,212,0.8)]' : 'border-white/10'}`}></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {transmissionMode === 'direct' ? (
                                    <textarea value={msgContent} onChange={e => setMsgContent(e.target.value)} placeholder="Compose HTML payload here..." className="w-full bg-[#111] border border-white/5 p-6 h-44 rounded-[40px] text-xs font-medium outline-none focus:border-cyan-500/50 resize-none shadow-2xl" />
                                ) : (
                                    <div className="bg-[#111] p-8 rounded-[40px] border border-white/5 space-y-6 shadow-2xl">
                                        <input value={universalLink} onChange={e => setUniversalLink(e.target.value)} placeholder="Paste t.me channel post link..." className="w-full bg-black/40 border border-white/5 p-5 rounded-3xl text-xs font-medium outline-none focus:border-cyan-500/50" />
                                        <div className="flex gap-6 items-center bg-black/40 p-5 rounded-3xl border border-white/[0.03]">
                                            <div className="flex-1">
                                                <p className="text-[8px] text-gray-600 uppercase font-black mb-1">Source Entity</p>
                                                <p className="text-[10px] font-black text-cyan-500 truncate">{parsedData.chatId || "No Data"}</p>
                                            </div>
                                            <div className="w-px h-10 bg-white/5"></div>
                                            <div className="flex-1">
                                                <p className="text-[8px] text-gray-600 uppercase font-black mb-1">Post Index</p>
                                                <p className="text-[10px] font-black text-cyan-500">{parsedData.msgId || "---"}</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <button onClick={broadcast} disabled={isBusy} className={`w-full py-6 rounded-[36px] font-black uppercase text-xs tracking-[0.3em] transition-all active:scale-[0.96] shadow-2xl ${isBusy ? 'bg-gray-900 text-gray-700' : 'bg-white text-black hover:bg-cyan-50'}`}>{isBusy ? 'Engaging Targets...' : `Transmit to ${targets.filter(t => t.selected).length} Nodes`}</button>

                                <div className="bg-black/80 rounded-[32px] p-6 h-52 overflow-y-auto border border-white/5 shadow-inner custom-scrollbar font-mono text-[10px] space-y-2 relative">
                                    <div className="flex justify-between items-center mb-4 sticky top-0 bg-black/95 py-2 z-10 border-b border-white/5">
                                        <span className="text-gray-500 font-black uppercase tracking-widest">Telemetry</span>
                                        <button onClick={() => setLogs([])} className="text-[8px] text-red-500/60 font-black uppercase">Flush</button>
                                    </div>
                                    <div className="space-y-1.5">
                                        {logs.map((l, i) => (
                                            <div key={i} className="flex gap-4 items-start border-b border-white/[0.02] pb-1">
                                                <span className="text-gray-700 w-16 opacity-50">{l.time}</span>
                                                <span className="text-cyan-600 font-black uppercase w-24 truncate">{l.target}</span>
                                                <span className={`font-medium ${l.status === 'ok' ? 'text-green-500/80' : 'text-red-500/80'}`}>{l.msg}</span>
                                            </div>
                                        ))}
                                        <div ref={logEndRef} />
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'settings' && (
                            <div className="space-y-6 animate-in">
                                <div className="bg-[#111] p-10 rounded-[44px] border border-white/5 space-y-8 shadow-2xl">
                                    <h2 className="text-xs font-black uppercase text-cyan-500 tracking-[0.4em]">Vault Authority</h2>
                                    <div className="space-y-6">
                                        <input type="password" value={geminiKey} onChange={e => setGeminiKey(e.target.value)} placeholder="Gemini Neural Key" className="w-full bg-black/40 border border-white/5 p-5 rounded-3xl text-xs outline-none focus:border-cyan-500/40" />
                                        <input type="password" value={tgToken} onChange={e => setTgToken(e.target.value)} placeholder="Telegram Protocol Token" className="w-full bg-black/40 border border-white/5 p-5 rounded-3xl text-xs outline-none focus:border-cyan-500/40" />
                                    </div>
                                    <button onClick={() => { localStorage.clear(); window.location.reload(); }} className="w-full py-4 rounded-2xl border border-red-500/20 text-red-500/60 text-[9px] font-black uppercase hover:bg-red-500/5 transition-colors">Clear All Vault Data</button>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-3xl border-t border-white/5 pb-10 pt-4 px-12 flex justify-between items-center z-50">
                        {[
                            { id: 'home', label: 'Bounty', icon: 'M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z' },
                            { id: 'nexus', label: 'Nexus', icon: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z' },
                            { id: 'settings', label: 'Vault', icon: 'M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z' }
                        ].map(item => (
                            <button key={item.id} onClick={() => setTab(item.id)} className="flex flex-col items-center gap-2 group transition-transform active:scale-90">
                                <div className={`w-16 h-8 flex items-center justify-center rounded-[20px] transition-all ${tab === item.id ? 'bg-cyan-500/20' : 'group-hover:bg-white/5'}`}>
                                    <svg viewBox="0 0 24 24" className={`w-6 h-6 transition-colors duration-300 ${tab === item.id ? 'fill-cyan-500' : 'fill-gray-700'}`}>
                                        <path d={item.icon} />
                                    </svg>
                                </div>
                                <span className={`text-[8px] font-black uppercase tracking-widest transition-colors duration-300 ${tab === item.id ? 'text-cyan-500' : 'text-gray-700'}`}>{item.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
  
